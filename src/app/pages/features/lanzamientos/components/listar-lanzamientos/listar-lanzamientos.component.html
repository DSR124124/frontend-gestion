<div class="lanzamientos-container">
  <p-toolbar class="custom-toolbar mb-3">
    <div class="p-toolbar-group-start">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          placeholder="Buscar por versión, aplicación, estado, notas o publicador..."
          [(ngModel)]="terminoBusqueda"
          (input)="filtrarLanzamientos()"
          class="p-inputtext-lg"
        />
      </span>
      <button
        *ngIf="terminoBusqueda"
        pButton
        type="button"
        icon="pi pi-times"
        label="Limpiar"
        class="p-button-text p-button-sm ml-2"
        (click)="limpiarBusqueda()"
      ></button>
    </div>
    <div class="p-toolbar-group-end">
      <button
        pButton
        type="button"
        icon="pi pi-plus"
        label="Nuevo Lanzamiento"
        class="p-button-primary"
        (click)="abrirDialogoCrear()"
      ></button>
      <button
        pButton
        type="button"
        icon="pi pi-refresh"
        label="Actualizar"
        class="p-button-info ml-2"
        (click)="cargarLanzamientos()"
        [disabled]="loading"
      ></button>
    </div>
  </p-toolbar>

  <div class="card tabla-datos">
    <p-table
      [value]="lanzamientosFiltrados"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} lanzamientos"
      [globalFilterFields]="['version', 'nombreAplicacion', 'estado', 'notasVersion', 'publicadoPorNombre']"
      styleClass="p-datatable-striped"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 5%">ID</th>
          <th style="width: 12%">Aplicación</th>
          <th style="width: 10%">Versión</th>
          <th style="width: 8%">Estado</th>
          <th style="width: 12%">Fecha Lanzamiento</th>
          <th style="width: 12%">Fecha Publicación</th>
          <th style="width: 15%">Notas</th>
          <th style="width: 8%">Tamaño</th>
          <th style="width: 8%">Crítico</th>
          <th style="width: 10%">Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-lanzamiento>
        <tr>
          <td>{{ lanzamiento.idLanzamiento }}</td>
          <td>
            <strong>{{ lanzamiento.nombreAplicacion || '-' }}</strong>
          </td>
          <td>
            <span class="badge-version">{{ lanzamiento.version }}</span>
          </td>
          <td>
            <p-tag
              [value]="getEstadoLabel(lanzamiento.estado)"
              [severity]="getSeverityEstado(lanzamiento.estado)"
            ></p-tag>
          </td>
          <td>{{ formatearFecha(lanzamiento.fechaLanzamiento) }}</td>
          <td>{{ formatearFecha(lanzamiento.fechaPublicacion) }}</td>
          <td>
            <span class="notas-version" [pTooltip]="lanzamiento.notasVersion" tooltipPosition="top">
              {{ (lanzamiento.notasVersion || '-').substring(0, 50) }}{{ (lanzamiento.notasVersion?.length || 0) > 50 ? '...' : '' }}
            </span>
          </td>
          <td>{{ formatearTamano(lanzamiento.tamanoArchivo) }}</td>
          <td>
            <i 
              *ngIf="lanzamiento.esCritico" 
              class="pi pi-exclamation-triangle text-danger"
              pTooltip="Actualización crítica"
              tooltipPosition="top"
            ></i>
            <span *ngIf="!lanzamiento.esCritico">-</span>
          </td>
          <td>
            <div class="acciones-cell">
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm p-button-success"
                pTooltip="Editar lanzamiento"
                tooltipPosition="top"
                (click)="editarLanzamiento(lanzamiento)"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-sm p-button-danger"
                pTooltip="Eliminar lanzamiento"
                tooltipPosition="top"
                (click)="confirmarEliminar(lanzamiento)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="10" class="text-center p-4">
            <div class="empty-message">
              <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i>
              <p>No se encontraron lanzamientos</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Componente de crear/editar lanzamiento -->
  <app-crear-lanzamiento
    #crearLanzamientoComponent
    (lanzamientoCreado)="onLanzamientoCreado()"
    (lanzamientoActualizado)="onLanzamientoActualizado()"
  ></app-crear-lanzamiento>

  <!-- Confirmación de eliminación -->
  <p-confirmDialog></p-confirmDialog>
</div>

