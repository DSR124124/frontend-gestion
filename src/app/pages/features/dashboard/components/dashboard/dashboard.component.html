<div class="dashboard-container">
  <div class="dashboard-header mb-4">
    <h1 class="dashboard-title">
      <i class="pi pi-chart-line"></i>
      Dashboard - Estadísticas de Lanzamientos
    </h1>
    <button
      pButton
      type="button"
      icon="pi pi-refresh"
      label="Actualizar"
      class="p-button-info"
      (click)="cargarDatos()"
      [disabled]="loading"
    ></button>
  </div>

  <!-- Tarjetas de resumen -->
  <div class="cards-grid mb-4">
    <div class="card summary-card">
      <div class="card-content">
        <div class="card-icon">
          <i class="pi pi-th-large"></i>
        </div>
        <div class="card-info">
          <h3>{{ totalAplicaciones }}</h3>
          <p>Aplicaciones Activas</p>
        </div>
      </div>
    </div>

    <div class="card summary-card">
      <div class="card-content">
        <div class="card-icon">
          <i class="pi pi-download"></i>
        </div>
        <div class="card-info">
          <h3>{{ totalLanzamientos }}</h3>
          <p>Lanzamientos Totales</p>
        </div>
      </div>
    </div>

    <div class="card summary-card">
      <div class="card-content">
        <div class="card-icon">
          <i class="pi pi-users"></i>
        </div>
        <div class="card-info">
          <h3>{{ totalUsuarios }}</h3>
          <p>Usuarios Activos</p>
        </div>
      </div>
    </div>

    <div class="card summary-card">
      <div class="card-content">
        <div class="card-icon">
          <i class="pi pi-sitemap"></i>
        </div>
        <div class="card-info">
          <h3>{{ promedioGrupos.toFixed(1) }}</h3>
          <p>Promedio Grupos por Lanzamiento</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="charts-grid">
    <div class="card chart-card">
      <div class="chart-container">
        <canvas id="chartUsuariosPorAplicacion"></canvas>
      </div>
    </div>

    <div class="card chart-card">
      <div class="chart-container">
        <canvas id="chartLanzamientosPorEstado"></canvas>
      </div>
    </div>

    <div class="card chart-card">
      <div class="chart-container">
        <canvas id="chartLanzamientosPorAplicacion"></canvas>
      </div>
    </div>

    <div class="card chart-card">
      <div class="chart-container">
        <canvas id="chartUsuariosConAcceso"></canvas>
      </div>
    </div>
  </div>

  <!-- Tabla de estadísticas -->
  <div class="card mt-4">
    <h3 class="table-title">Estadísticas Detalladas de Lanzamientos</h3>
    <p-table
      [value]="estadisticas"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} lanzamientos"
      styleClass="p-datatable-striped"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Aplicación</th>
          <th>Versión</th>
          <th>Estado</th>
          <th>Fecha Lanzamiento</th>
          <th>Usuarios con Acceso</th>
          <th>Grupos Asignados</th>
          <th>Crítico</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-estadistica>
        <tr>
          <td>
            <strong>{{ estadistica.nombreAplicacion || '-' }}</strong>
          </td>
          <td>
            <span class="badge-version">{{ estadistica.version || '-' }}</span>
          </td>
          <td>
            <p-tag
              [value]="estadistica.estado || '-'"
              [severity]="getSeverityEstado(estadistica.estado)"
            ></p-tag>
          </td>
          <td>{{ formatearFecha(estadistica.fechaLanzamiento) }}</td>
          <td>
            <span class="badge-number">{{ estadistica.usuariosConAcceso || 0 }}</span>
          </td>
          <td>
            <span class="badge-number">{{ estadistica.gruposAsignados || 0 }}</span>
          </td>
          <td>
            <i 
              *ngIf="estadistica.esCritico" 
              class="pi pi-exclamation-triangle text-danger"
              pTooltip="Actualización crítica"
              tooltipPosition="top"
            ></i>
            <span *ngIf="!estadistica.esCritico">-</span>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center p-4">
            <div class="empty-message">
              <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i>
              <p>No se encontraron estadísticas</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

